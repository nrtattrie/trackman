<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trackman Distance Calculator</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #0d0d1a;
    color: #c8cad0;
    min-height: 100vh;
    padding: 20px 16px 40px;
  }
  h1 {
    text-align: center;
    font-size: 1.2rem;
    font-weight: 500;
    color: #5eb8d4;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 24px;
  }
  .card {
    background: #14142a;
    border: 1px solid #1e1e3a;
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 14px;
  }
  .field {
    margin-bottom: 14px;
  }
  .field:last-child {
    margin-bottom: 0;
  }
  label {
    display: block;
    font-size: 0.7rem;
    color: #6b6e7a;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 600;
  }
  button {
    -webkit-appearance: none;
    touch-action: manipulation;
  }
  input, select {
    width: 100%;
    padding: 12px 14px;
    font-size: 1.1rem;
    background: #0d0d1a;
    border: 1px solid #252540;
    border-radius: 10px;
    color: #e8e8ef;
    -webkit-appearance: none;
    transition: border-color 0.2s;
  }
  input:focus, select:focus {
    outline: none;
    border-color: #5eb8d4;
    box-shadow: 0 0 0 2px rgba(94, 184, 212, 0.1);
  }
  input::placeholder {
    color: #3a3a50;
  }
  .input-row {
    display: flex;
    gap: 10px;
  }
  .input-group {
    flex: 1;
  }
  .input-group label {
    font-size: 0.65rem;
    color: #505360;
  }
  .result-box {
    margin-top: 18px;
    background: linear-gradient(135deg, #111130, #0a1628);
    border: 1px solid #1a2a4a;
    border-radius: 16px;
    padding: 28px 24px;
    text-align: center;
  }
  .result-label {
    font-size: 0.7rem;
    color: #50536a;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-weight: 600;
    margin-bottom: 8px;
  }
  .result-value {
    font-size: 3.2rem;
    font-weight: 700;
    color: #5eb8d4;
    letter-spacing: -1px;
  }
  .result-unit {
    font-size: 1rem;
    color: #3a4a6a;
    margin-left: 6px;
    font-weight: 500;
  }
  .hint {
    font-size: 0.7rem;
    color: #3e4050;
    margin-top: 4px;
  }

  /* Lie presets */
  .lie-presets {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 14px;
  }
  .lie-presets > label {
    margin-bottom: 4px;
    width: 100%;
  }
  .lie-btn {
    padding: 8px 12px;
    font-size: 0.78rem;
    font-weight: 500;
    background: #0d0d1a;
    border: 1px solid #252540;
    border-radius: 8px;
    color: #6b6e7a;
    cursor: pointer;
    flex: 1 1 auto;
    text-align: center;
    min-width: 0;
    transition: all 0.2s;
  }
  .lie-btn.active {
    background: #111130;
    border-color: #5eb8d4;
    color: #5eb8d4;
    box-shadow: 0 0 8px rgba(94, 184, 212, 0.15);
  }

  /* Wind compass */
  .wind-section > label {
    margin-bottom: 10px;
  }
  .wind-layout {
    display: flex;
    align-items: center;
    gap: 18px;
  }
  .compass {
    position: relative;
    width: 140px;
    height: 140px;
    flex-shrink: 0;
  }
  .compass-ring {
    position: absolute;
    inset: 10px;
    border: 1px solid #1e1e3a;
    border-radius: 50%;
    pointer-events: none;
  }
  .compass-dir {
    position: absolute;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background: #0d0d1a;
    border: 1px solid #252540;
    color: #50536a;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.3px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transform: translate(-50%, -50%);
    z-index: 1;
    transition: all 0.2s;
  }
  .compass-dir.active {
    background: #111130;
    border-color: #5eb8d4;
    color: #5eb8d4;
    box-shadow: 0 0 10px rgba(94, 184, 212, 0.2);
  }
  .wind-speed-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .wind-speed-wrap input {
    width: 100%;
  }
  .wind-desc {
    font-size: 0.78rem;
    color: #5eb8d4;
    min-height: 1.2em;
    font-weight: 500;
  }

  /* Reset */
  .reset-btn {
    display: block;
    width: 100%;
    margin-top: 14px;
    padding: 12px;
    font-size: 0.8rem;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    background: transparent;
    border: 1px solid #1e1e3a;
    border-radius: 10px;
    color: #50536a;
    cursor: pointer;
    transition: all 0.2s;
  }
  .reset-btn:active {
    background: #14142a;
    color: #8a8da0;
  }

  /* Flash animation */
  .result-box.flash .result-value {
    animation: pulse 0.3s ease;
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.06); color: #fff; }
    100% { transform: scale(1); }
  }
</style>
</head>
<body>

<h1>Trackman Distance Calc</h1>

<div class="card">
  <div class="field">
    <label>Distance to Pin (yards)</label>
    <input type="number" id="distance" inputmode="decimal" placeholder="150">
  </div>
</div>

<div class="card">
  <div class="field">
    <label>Height Differential</label>
    <div class="input-row">
      <div class="input-group">
        <label>Feet</label>
        <input type="number" id="heightFt" inputmode="decimal" value="0">
      </div>
      <div class="input-group">
        <label>Inches</label>
        <input type="number" id="heightIn" inputmode="decimal" value="0">
      </div>
    </div>
    <div class="hint">Positive = uphill, negative = downhill</div>
  </div>
</div>

<div class="card">
  <div class="lie-presets">
    <label>Lie</label>
    <button class="lie-btn active" data-dist="100" data-spin="100">Fairway</button>
    <button class="lie-btn" data-dist="93" data-spin="80">Light Rough</button>
    <button class="lie-btn" data-dist="86" data-spin="60">Heavy Rough</button>
    <button class="lie-btn" data-dist="86" data-spin="70">FW Bunker</button>
    <button class="lie-btn" data-dist="80" data-spin="50">GS Bunker</button>
  </div>

  <div class="field">
    <label>Distance %</label>
    <input type="number" id="distPct" inputmode="decimal" value="100">
  </div>

  <div class="field">
    <label>Spin %</label>
    <input type="number" id="spinPct" inputmode="decimal" value="100">
  </div>
</div>

<div class="card wind-section">
  <label>Wind</label>
  <div class="wind-layout">
    <div class="compass">
      <div class="compass-ring"></div>
      <button class="compass-dir" data-dir="N"  style="top:4%;left:50%">N</button>
      <button class="compass-dir" data-dir="NE" style="top:15%;left:85%">NE</button>
      <button class="compass-dir" data-dir="E"  style="top:50%;left:96%">E</button>
      <button class="compass-dir" data-dir="SE" style="top:85%;left:85%">SE</button>
      <button class="compass-dir" data-dir="S"  style="top:96%;left:50%">S</button>
      <button class="compass-dir" data-dir="SW" style="top:85%;left:15%">SW</button>
      <button class="compass-dir" data-dir="W"  style="top:50%;left:4%">W</button>
      <button class="compass-dir" data-dir="NW" style="top:15%;left:15%">NW</button>
    </div>
    <div class="wind-speed-wrap">
      <label>Speed (mph)</label>
      <input type="number" id="windSpeed" inputmode="decimal" value="0">
      <div class="wind-desc" id="windDesc">No wind selected</div>
    </div>
  </div>
  <div class="hint" style="margin-top:8px">N = headwind | S = tailwind | E/W = crosswind</div>
</div>

<div class="result-box" id="resultBox">
  <div class="result-label">Aim For</div>
  <div><span class="result-value" id="result">—</span><span class="result-unit">yds</span></div>
</div>

<button class="reset-btn" id="resetBtn">Reset All</button>

<script>
  const $ = id => document.getElementById(id);
  let lastResult = '';

  const headComponent = {
    N: 1, NE: 0.707, E: 0, SE: -0.707, S: -1, SW: -0.707, W: 0, NW: 0.707
  };
  const windLabels = {
    N: 'Headwind', NE: 'Head + crosswind', E: 'Crosswind',
    SE: 'Tail + crosswind', S: 'Tailwind', SW: 'Tail + crosswind',
    W: 'Crosswind', NW: 'Head + crosswind'
  };

  function calc() {
    const dist = parseFloat($('distance').value);
    if (!dist || dist <= 0) { $('result').textContent = '—'; return; }

    const heightFt = (parseFloat($('heightFt').value) || 0) + (parseFloat($('heightIn').value) || 0) / 12;
    const distPct = parseFloat($('distPct').value) || 100;
    const spinPct = parseFloat($('spinPct').value) || 100;
    const windSpeed = parseFloat($('windSpeed').value) || 0;
    const activeDir = document.querySelector('.compass-dir.active');
    const windDir = activeDir ? activeDir.dataset.dir : null;

    const elevAdj = heightFt / 3;
    const hc = windDir ? headComponent[windDir] : 0;
    const windAdj = windSpeed * (hc >= 0 ? hc * 1.0 : hc * 0.5);
    const adjusted = (dist + elevAdj + windAdj) / (distPct / 100);

    const lo = Math.round(adjusted) - 2;
    const hi = Math.round(adjusted) + 2;
    const text = lo + '–' + hi;

    if (text !== lastResult) {
      lastResult = text;
      $('result').textContent = text;
      const box = $('resultBox');
      box.classList.remove('flash');
      void box.offsetWidth;
      box.classList.add('flash');
      if (navigator.vibrate) navigator.vibrate(10);
    }

    saveState();
  }

  // --- localStorage persistence ---
  const STORAGE_KEY = 'trackman-calc';

  function saveState() {
    const activeDir = document.querySelector('.compass-dir.active');
    const activeLie = document.querySelector('.lie-btn.active');
    const state = {
      distance: $('distance').value,
      heightFt: $('heightFt').value,
      heightIn: $('heightIn').value,
      distPct: $('distPct').value,
      spinPct: $('spinPct').value,
      windSpeed: $('windSpeed').value,
      windDir: activeDir ? activeDir.dataset.dir : null,
      lie: activeLie ? activeLie.textContent : null
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function loadState() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    try {
      const s = JSON.parse(raw);
      if (s.distance) $('distance').value = s.distance;
      if (s.heightFt) $('heightFt').value = s.heightFt;
      if (s.heightIn) $('heightIn').value = s.heightIn;
      if (s.distPct) $('distPct').value = s.distPct;
      if (s.spinPct) $('spinPct').value = s.spinPct;
      if (s.windSpeed) $('windSpeed').value = s.windSpeed;
      if (s.windDir) {
        const btn = document.querySelector(`.compass-dir[data-dir="${s.windDir}"]`);
        if (btn) {
          btn.classList.add('active');
          $('windDesc').textContent = windLabels[s.windDir];
        }
      }
      if (s.lie) {
        document.querySelectorAll('.lie-btn').forEach(b => {
          b.classList.toggle('active', b.textContent === s.lie);
        });
      }
      calc();
    } catch(e) {}
  }

  // --- iOS touch compatibility ---
  function addTap(el, handler) {
    el.addEventListener('click', handler);
    el.addEventListener('touchend', e => { e.preventDefault(); handler(); });
  }

  // --- Reset ---
  addTap($('resetBtn'), () => {
    $('distance').value = '';
    $('heightFt').value = '0';
    $('heightIn').value = '0';
    $('distPct').value = '100';
    $('spinPct').value = '100';
    $('windSpeed').value = '0';
    document.querySelectorAll('.compass-dir').forEach(b => b.classList.remove('active'));
    $('windDesc').textContent = 'No wind selected';
    document.querySelectorAll('.lie-btn').forEach(b => b.classList.remove('active'));
    document.querySelector('.lie-btn[data-dist="100"]').classList.add('active');
    $('result').textContent = '—';
    lastResult = '';
    localStorage.removeItem(STORAGE_KEY);
  });

  // --- Compass clicks ---
  document.querySelectorAll('.compass-dir').forEach(btn => {
    const handler = () => {
      const wasActive = btn.classList.contains('active');
      document.querySelectorAll('.compass-dir').forEach(b => b.classList.remove('active'));
      if (!wasActive) {
        btn.classList.add('active');
        $('windDesc').textContent = windLabels[btn.dataset.dir];
      } else {
        $('windDesc').textContent = 'No wind selected';
      }
      calc();
    };
    addTap(btn, handler);
  });

  // --- Input listeners ---
  document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calc));

  // --- Lie preset clicks ---
  document.querySelectorAll('.lie-btn').forEach(btn => {
    const handler = () => {
      document.querySelectorAll('.lie-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      $('distPct').value = btn.dataset.dist;
      $('spinPct').value = btn.dataset.spin;
      calc();
    };
    addTap(btn, handler);
  });

  // Clear active preset when user manually edits dist% or spin%
  ['distPct', 'spinPct'].forEach(id => {
    $(id).addEventListener('input', () => {
      document.querySelectorAll('.lie-btn').forEach(b => b.classList.remove('active'));
    });
  });

  // --- Load saved state on startup ---
  loadState();
</script>

</body>
</html>
